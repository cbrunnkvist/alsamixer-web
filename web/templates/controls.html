{{/*
  Mixer controls templates

  These templates are intended to be composed into a base layout
  using Go's html/template package. The "controls" template renders
  the main mixer area and iterates over sound cards; the "control"
  template renders a single mixer control with accessible ARIA
  attributes for volume sliders and switches.
*/}}

{{define "controls"}}
<main id="mixer-main" class="mixer-main" role="main" aria-label="ALSA mixer controls">
  <section id="mixer-live-region" class="sr-only" aria-live="polite" aria-atomic="true"></section>

  {{range .Cards}}
  <section class="mixer-card" aria-labelledby="card-{{.ID}}" data-card-id="{{.ID}}" data-current-view="playback">
    <header class="mixer-card__header">
      <div class="mixer-card__title-row">
        <span class="mixer-card__index" aria-hidden="true">Card {{.ID}}</span>
        <h2 id="card-{{.ID}}" class="mixer-card__title">{{.Name}}</h2>
      </div>
      {{if .Description}}
      <p class="mixer-card__description">{{.Description}}</p>
      {{end}}
      <div class="mixer-card__view" role="group" aria-label="Mixer view">
        <button type="button" class="mixer-card__view-button" data-view="playback" aria-pressed="true">Playback</button>
        <button type="button" class="mixer-card__view-button" data-view="capture" aria-pressed="false">Capture</button>
        <button type="button" class="mixer-card__view-button" data-view="all" aria-pressed="false">All</button>
      </div>
    </header>

    <div class="mixer-card__controls">
      {{range .Controls}}
        {{template "control" .}}
      {{end}}
    </div>
    <p class="mixer-card__empty" role="status" aria-live="polite"></p>
    <div class="mixer-card__nav" aria-label="Control navigation">
      <button type="button" class="mixer-card__nav-button" data-nav="prev" aria-label="Previous control">[&lt;]</button>
      <span class="mixer-card__nav-label" data-active-label aria-live="polite"></span>
      <button type="button" class="mixer-card__nav-button" data-nav="next" aria-label="Next control">[&gt;]</button>
    </div>
  </section>
  {{end}}
</main>
{{end}}

{{define "control"}}
<article class="mixer-control" id="control-{{.CardID}}-{{.ID}}" data-control-id="{{.ID}}" data-card-id="{{.CardID}}" data-control-name="{{.Name}}" data-base-name="{{.BaseName}}" data-control-view="{{.View}}">
  <header class="mixer-control__header">
    <div class="mixer-control__title-row">
      <h3 class="mixer-control__label">{{.Name}}</h3>
      <div class="mixer-control__type-badges" aria-hidden="true">
        {{if .HasVolume}}
        <span class="mixer-control__type-badge mixer-control__type-badge--volume">VOL</span>
        {{end}}
        {{if .HasMute}}
        <span class="mixer-control__type-badge mixer-control__type-badge--mute">MUTE</span>
        {{end}}
        {{if .HasCapture}}
        <span class="mixer-control__type-badge mixer-control__type-badge--capture">CAPTURE</span>
        {{end}}
      </div>
    </div>
    {{if .Description}}
    <p class="mixer-control__description" id="control-desc-{{.ID}}">{{.Description}}</p>
    {{end}}
  </header>

  <div class="mixer-control__body">
    {{/* Volume slider */}}
    {{if .HasVolume}}
    <div
      class="mixer-control__volume"
      id="volume-{{.CardID}}-{{.ID}}"
      role="slider"
      tabindex="0"
      aria-label="{{.VolumeAriaLabel}}"
      aria-valuemin="{{.VolumeMin}}"
      aria-valuemax="{{.VolumeMax}}"
      aria-valuenow="{{.VolumeNow}}"
      aria-valuetext="{{.VolumeText}}"
      aria-describedby="volume-help-{{.ID}}"
      data-control-kind="volume"
      data-card-id="{{.CardID}}"
      data-control-name="{{.Name}}"
      data-base-name="{{.BaseName}}"
      data-volume-step="{{.VolumeStep}}"
      style="--volume-percent: {{.VolumeNow}}%;">
      <div class="mixer-control__volume-track">
        <div class="mixer-control__volume-fill" aria-hidden="true"></div>
      </div>
      <span class="mixer-control__value" aria-hidden="true">{{.VolumeText}}</span>
    </div>
    <p id="volume-help-{{.ID}}" class="sr-only">
      Use left and right arrow keys to adjust the volume for {{.Name}}.
    </p>
    {{end}}

    {{/* Mute toggle */}}
    {{if .HasMute}}
    <button
      type="button"
      class="mixer-control__toggle mixer-control__toggle--mute"
      role="switch"
      aria-label="{{.MuteAriaLabel}}"
      aria-checked="{{if .Muted}}true{{else}}false{{end}}"
      aria-describedby="mute-help-{{.ID}}"
      data-control-kind="mute"
      data-control-type="toggle"
      data-card-id="{{.CardID}}"
      data-control-name="{{.Name}}"
      data-base-name="{{.BaseName}}"
      hx-post="/card/{{.CardID}}/control/{{.BaseName}}/mute"
      hx-trigger="click, keyup[key=='Enter' || key==' ' || key=='Space']"
      hx-swap="none">
      <span class="sr-only" id="mute-help-{{.ID}}">
        {{if .Muted}}Mute enabled for {{.Name}}.{{else}}Mute disabled for {{.Name}}.{{end}}
      </span>
      <span class="mixer-control__toggle-label" aria-hidden="true">
        {{if .Muted}}Muted{{else}}Unmuted{{end}}
      </span>
    </button>
    {{end}}

    {{/* Capture toggle */}}
    {{if .HasCapture}}
    <button
      type="button"
      class="mixer-control__toggle mixer-control__toggle--capture"
      role="switch"
      aria-label="{{.CaptureAriaLabel}}"
      aria-checked="{{if .CaptureActive}}true{{else}}false{{end}}"
      aria-describedby="capture-help-{{.ID}}"
      data-control-kind="capture"
      data-control-type="toggle"
      data-card-id="{{.CardID}}"
      data-control-name="{{.Name}}"
      data-base-name="{{.BaseName}}"
      hx-post="/card/{{.CardID}}/control/{{.BaseName}}/capture"
      hx-trigger="click, keyup[key=='Enter' || key==' ' || key=='Space']"
      hx-swap="none">
      <span class="sr-only" id="capture-help-{{.ID}}">
        {{if .CaptureActive}}Capture enabled for {{.Name}}.{{else}}Capture disabled for {{.Name}}.{{end}}
      </span>
      <span class="mixer-control__toggle-label" aria-hidden="true">
        {{if .CaptureActive}}Capture On{{else}}Capture Off{{end}}
      </span>
    </button>
    {{end}}
  </div>
</article>
{{end}}
